import{S as P}from"./Primitive-CT1nwTPS.js";import{U as O,d as y,g as w,o as p,u as s,w as r,q as C,a as I,z as F,bd as Q,O as W,A as g,n as X,k as Z,e as u,F as V,j as q,b,i as aa,h as D,t as x}from"./app-X6IBNoOp.js";import{c as S}from"./utils-DSuOEapb.js";import{u as ea}from"./useForwardPropsEmits-DCASyspC.js";import{_ as ta}from"./Label.vue_vue_type_script_setup_true_lang-CQ2XjqgU.js";import{b as sa,c as oa,d as na,e as ia,f as ra,E as la,t as da,F as ua}from"./vee-validate-zod-CppCHWBl.js";import{a as N,g as J,_ as R,c as ca}from"./client-CoSIhTpW.js";import{t as m}from"./index-BWPUmTLK.js";import{u as ma}from"./useAlertDialog-Deaumr1f.js";import{_ as fa,a as pa,d as _a,b as ga,c as va}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CoYiqVdQ.js";import{_ as ha,a as ya,b as $a,c as ba,d as xa}from"./CardTitle.vue_vue_type_script_setup_true_lang-D_3rsHp5.js";import{_ as Ia}from"./TabulatorTable.vue_vue_type_script_setup_true_lang-CJSfjonO.js";const A=Symbol();function k(){const c=O(ra),e=O(A);if(!c)throw new Error("useFormField should be used within <FormField>");const{name:o}=c,n=e,l={valid:ia(o),isDirty:na(o),isTouched:oa(o),error:sa(o)};return{id:n,name:o,formItemId:`${n}-form-item`,formDescriptionId:`${n}-form-item-description`,formMessageId:`${n}-form-item-message`,...l}}const Aa=y({__name:"FormControl",setup(c){const{error:e,formItemId:o,formDescriptionId:n,formMessageId:l}=k();return(v,M)=>(p(),w(s(P),{id:s(o),"data-slot":"form-control","aria-describedby":s(e)?`${s(n)} ${s(l)}`:`${s(n)}`,"aria-invalid":!!s(e)},{default:r(()=>[C(v.$slots,"default")]),_:3},8,["id","aria-describedby","aria-invalid"]))}}),Ga=y({__name:"FormItem",props:{class:{}},setup(c){const e=c,o=ea();return Q(A,o),(n,l)=>(p(),I("div",{"data-slot":"form-item",class:F(s(S)("grid gap-2",e.class))},[C(n.$slots,"default")],2))}}),ja=y({__name:"FormLabel",props:{for:{},asChild:{type:Boolean},as:{},required:{type:Boolean},class:{}},setup(c){const e=c,{error:o,formItemId:n}=k();return(l,v)=>(p(),w(s(ta),{"data-slot":"form-label","data-error":!!s(o),class:F(s(S)("data-[error=true]:text-destructive",e.class)),for:s(n),required:e.required},{default:r(()=>[C(l.$slots,"default")]),_:3},8,["data-error","class","for","required"]))}}),za=y({__name:"FormMessage",props:{class:{}},setup(c){const e=c,{name:o,formMessageId:n}=k();return(l,v)=>(p(),w(s(la),{id:s(n),"data-slot":"form-message",as:"p",name:W(s(o)),class:F(s(S)("text-destructive text-right italic text-sm",e.class))},null,8,["id","name","class"]))}}),Ca={key:0},Fa={class:"text-sm font-light text-gray-500"},Ta=["id","onSubmit"],Da={class:"w-full flex gap-1"},Ha=y({__name:"ContentLayout",props:{dialogTitle:{},dialogDescription:{},routeName:{},columns:{},viewResponse:{},schema:{},mainContent:{default:"Master data"},actions:{}},setup(c){const e=c,o=g({data:[],loading:!0}),n=g(!1),l=g(null),v=da(e.schema),M=ma(),_=g(null),f=g(null),B=g(null);X(G);async function G(){o.value.loading=!0;try{const a=(await N[e.routeName].index()).data??[];o.value.data=a.map(d=>{const i=J();return E({...d,itemid:i,actions:JSON.parse(JSON.stringify(e.actions))})})}catch(t){console.error(t),m.error("Gagal memuat data")}finally{o.value.loading=!1}}function j(t){B.value=t}function z(t){var d,i;const a=(d=B.value)==null?void 0:d.getRow(t);a&&(a.scrollTo("center",!1),(i=a.select)==null||i.call(a))}function E(t){return t.actions=(t.actions||[]).map(a=>(a.button&&(a.button.attributes={itemid:t.itemid},a.type==="edit"?a.button.onClick=()=>{H(t)}:a.type==="delete"&&(a.button.onClick=()=>{K(t)})),a)),t}function H(t){var d,i;l.value=t,n.value=!0,(d=f.value)==null||d.call(f);const a=e.schema.safeParse(t);a.success?(i=_.value)==null||i.call(_,a.data):console.error("Data tidak valid menurut schema:",a.error)}function K(t){M.confirm({title:"Hapus Data?",description:"Data yang dihapus tidak bisa dikembalikan.",confirmText:"Ya, Hapus",cancelText:"Batal",onConfirm:()=>{L(t)}})}async function L(t){m.loading(`${e.mainContent} dalam penghapusan...`);try{(await N[e.routeName].delete(t.id)).data?(m.success(`${e.mainContent} berhasil dihapus`),o.value.data=o.value.data.filter(d=>d.itemid!==t.itemid)):m.error(`${e.mainContent} gagal dihapus`)}catch(a){console.error(a),m.error("Gagal menghapus data")}finally{setTimeout(()=>m.dismiss(),3e3)}}async function U(t){var a;m.loading(`${e.mainContent} dalam penyimpanan...`);try{let i=(await N[e.routeName].store(t)).data;if(i){m.success(`${e.mainContent} berhasil disimpan`);let $=((a=l.value)==null?void 0:a.itemid)||J();i=E({...i,itemid:$,actions:JSON.parse(JSON.stringify(e.actions))});const h=o.value.data.findIndex(T=>T.itemid===$);h!==-1?(o.value.data=o.value.data.filter(T=>T.itemid!==t.itemid),o.value.data.splice(h,1,i)):o.value.data=[...o.value.data,i],n.value=!1,l.value=null,setTimeout(()=>z(i.id),100)}}catch(d){console.error(d),m.error("Gagal menyimpan data")}finally{setTimeout(()=>m.dismiss(),3e3)}}function Y(){l.value=null,n.value=!0}return Z(n,t=>{var a;t||(l.value=null,(a=f.value)==null||a.call(f))}),(t,a)=>(p(),I(V,null,[u(s(ua),{as:"","validation-schema":s(v),"keep-values":!1,class:"flex flex-col gap-2"},{default:r(({handleSubmit:d,setValues:i,resetForm:$})=>[!_.value&&!f.value?(p(),I(V,{key:0},[(_.value=i)&&(f.value=$)?(p(),I("div",Ca)):q("",!0)],64)):q("",!0),u(s(fa),{open:n.value,"onUpdate:open":a[0]||(a[0]=h=>n.value=h)},{default:r(()=>[u(s(pa),{class:"2xl:max-w-[800px] max-h-[90dvh]"},{"dialog-title":r(()=>[u(s(ga),null,{default:r(()=>[D(x(e.dialogTitle),1)]),_:1}),u(s(va),{class:"overflow-auto"},{default:r(()=>[b("p",Fa,x(e.dialogDescription),1)]),_:1})]),default:r(()=>[b("form",{id:e.routeName+"dataForm",onSubmit:aa(h=>d(U),["prevent"])},[C(t.$slots,"default",{editData:l.value,setValues:_.value,resetForm:f.value})],40,Ta),u(s(_a),null,{default:r(()=>[u(R,{type:"submit",form:e.routeName+"dataForm",buttonType:"save"},{default:r(()=>a[1]||(a[1]=[D(" Simpan ")])),_:1},8,["form"])]),_:1})]),_:2},1024)]),_:2},1032,["open"])]),_:3},8,["validation-schema"]),u(s(xa),{class:F(s(ca)("w-full",t.$attrs.class??""))},{default:r(()=>[u(s(ha),null,{default:r(()=>[u(s(ya),null,{default:r(()=>[D(x(e.dialogTitle),1)]),_:1}),u(s($a),null,{default:r(()=>[b("div",Da,[b("span",null,x(e.dialogDescription),1),u(R,{type:"button",class:"ml-auto",buttonType:"add",onClick:Y})])]),_:1})]),_:1}),u(s(ba),{class:"grid gap-4"},{default:r(()=>[u(Ia,{usingFilter:!1,loading:o.value.loading,data:o.value.data,columns:e.columns,id:"setting-"+e.routeName,"tabulator-class":"!h-[400px]",options:{},onTableReady:j},null,8,["loading","data","columns","id"])]),_:1})]),_:1},8,["class"])],64))}});export{Ha as _,Ga as a,Aa as b,za as c,ja as d};
